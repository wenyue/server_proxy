# Nginx Stream Bandwidth Logs Rotation Configuration
# This file manages automatic rotation of bandwidth monitoring logs

/var/log/nginx/stream_*_bandwidth.log {
    # Rotate when file size exceeds 100MB
    size 100M

    # Keep 10 rotated files
    rotate 10

    # Compress old logs to save space
    compress
    delaycompress
    notifempty
    create 0644 www-data www-data
    dateext
    missingok
    
    # Use shared scripts for multiple files
    sharedscripts

    postrotate
        # Try multiple methods to reload nginx gracefully
        if [ -f /run/nginx.pid ]; then
            /bin/kill -USR1 $(cat /run/nginx.pid) 2>/dev/null
        elif [ -f /var/run/nginx.pid ]; then
            /bin/kill -USR1 $(cat /var/run/nginx.pid) 2>/dev/null
        elif systemctl is-active nginx >/dev/null 2>&1; then
            systemctl reload nginx
        fi
    endscript
}
