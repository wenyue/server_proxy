# TCP 5001 -> backend 192.154.96.230:5001
upstream backend_5001_tcp {
    server 192.154.96.230:5001;   # Replace with your backend if needed
}

server {
    listen 0.0.0.0:5001;          # Listen on TCP/5001 (IPv4)
    listen [::]:5001;             # Listen on TCP/5001 (IPv6)
    proxy_connect_timeout 5s;     # Upstream connect timeout
    proxy_timeout 300s;           # Session timeout
    proxy_pass backend_5001_tcp;  # Forward to backend
    
    # Enable bandwidth logging
    access_log /var/log/nginx/stream_5001_tcp_bandwidth.log proxy_bandwidth;
}

# UDP 5001 -> backend 192.154.96.230:5001 (e.g., QUIC/IPFS)
upstream backend_5001_udp {
    server 192.154.96.230:5001;   # Same backend for UDP
}

server {
    listen 0.0.0.0:5001 udp;      # Listen on UDP/5001 (IPv4)
    listen [::]:5001 udp;         # Listen on UDP/5001 (IPv6)
    proxy_timeout 120s;           # UDP session timeout
    proxy_pass backend_5001_udp;  # Forward to backend
    
    # Enable bandwidth logging
    access_log /var/log/nginx/stream_5001_udp_bandwidth.log proxy_bandwidth;
}
